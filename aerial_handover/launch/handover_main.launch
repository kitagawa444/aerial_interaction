<launch>

  <!-- DRAGON / Gazebo のモード切り替え -->
  <!-- 今はシミュレーションだけ使うので rm のデフォルトは False にしておく -->
  <arg name="rm"          default="False" />
  <arg name="sim"         default="True" />
  <!-- Gazebo の GUI を出すかどうか -->
  <arg name="headless"    default="False" />
  <!-- 手の位置のソース：marker or mocap -->
  <arg name="hand_source" default="marker" />


  <!-- =====================================
       DRAGON + Gazebo + 目・手モデル (task)
       ===================================== -->
  <include file="$(find aerial_handover)/launch/task.launch">
    <arg name="rm"          value="$(arg rm)" />
    <arg name="sim"         value="$(arg sim)" />
    <arg name="headless"    value="$(arg headless)" />
    <arg name="hand_source" value="$(arg hand_source)" />
  </include>

  <!-- =====================================
       IKベースナビゲーション + マーカー
       ===================================== -->
  <!-- <include file="$(find ik_base_nav)/launch/dragon_navigation.launch"> -->
    <!-- 追加：use_markerを下流に流す -->
    <!-- <arg name="use_marker" value="$(eval arg('hand_source') == 'marker')" /> -->
    <!-- </include> -->

  <!-- ======================
       マーカー → handターゲット
       ====================== -->
  <node pkg="aerial_handover"
        type="marker_to_hand_target.py"
        name="marker_to_hand_target"
        output="screen"
        if="$(eval arg('hand_source') == 'marker')" >
    <param name="in_topic"  value="/desired_3D_pose" />
    <param name="out_topic" value="/hand/target_pose" />
  </node>

    <!-- ======================
       mocap → handターゲット
       hand_source が mocap のときだけ動かす
       ====================== -->
  <node pkg="aerial_handover"
        type="mocap_to_hand_target.py"
        name="mocap_to_hand_target"
        output="screen"
        if="$(eval arg('hand_source') == 'mocap')" />




  <!-- ======================
       Gazebo の hand モデル追従
       ====================== -->
  <node pkg="aerial_handover"
        type="hand_gazebo_from_interactive_marker.py"
        name="hand_gazebo_from_interactive_marker"
        output="screen"
        if="$(arg sim)">
    <param name="model_name" value="hand" />
    <param name="pose_topic" value="/hand/target_pose" />
  </node>


</launch>
